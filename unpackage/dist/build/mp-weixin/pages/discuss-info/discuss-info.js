(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/discuss-info/discuss-info"],{"14b4":function(n,t,e){"use strict";e.d(t,"b",(function(){return u})),e.d(t,"c",(function(){return i})),e.d(t,"a",(function(){return o}));var o={uEmpty:function(){return e.e("uview-ui/components/u-empty/u-empty").then(e.bind(null,"70de"))},myLoading:function(){return e.e("components/my-loading/my-loading").then(e.bind(null,"f09b"))},uParse:function(){return Promise.all([e.e("common/vendor"),e.e("uview-ui/components/u-parse/u-parse")]).then(e.bind(null,"7cb4"))},uImage:function(){return e.e("uview-ui/components/u-image/u-image").then(e.bind(null,"4381"))},uGap:function(){return e.e("uview-ui/components/u-gap/u-gap").then(e.bind(null,"4afd"))},uTabs:function(){return e.e("uview-ui/components/u-tabs/u-tabs").then(e.bind(null,"2e46"))},uLine:function(){return e.e("uview-ui/components/u-line/u-line").then(e.bind(null,"1d42"))},discussComment:function(){return e.e("components/discuss-comment/discuss-comment").then(e.bind(null,"4b27"))},inputCommentReply:function(){return e.e("components/input-comment-reply/input-comment-reply").then(e.bind(null,"ed2f"))},uPopup:function(){return e.e("uview-ui/components/u-popup/u-popup").then(e.bind(null,"55b4"))},uAlertTips:function(){return e.e("uview-ui/components/u-alert-tips/u-alert-tips").then(e.bind(null,"e03d"))}},u=function(){var n=this,t=n.$createElement;n._self._c},i=[]},"47f3":function(n,t,e){"use strict";(function(n){e("1111");o(e("66fd"));var t=o(e("5937"));function o(n){return n&&n.__esModule?n:{default:n}}n(t.default)}).call(this,e("543d")["createPage"])},5937:function(n,t,e){"use strict";e.r(t);var o=e("14b4"),u=e("dadd");for(var i in u)"default"!==i&&function(n){e.d(t,n,(function(){return u[n]}))}(i);e("5ed0");var r,s=e("f0c5"),c=Object(s["a"])(u["default"],o["b"],o["c"],!1,null,"1aebb110",null,!1,o["a"],r);t["default"]=c.exports},"5ed0":function(n,t,e){"use strict";var o=e("7942"),u=e.n(o);u.a},7942:function(n,t,e){},"8f55":function(n,t,e){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=c(e("a34a")),u=c(e("8164")),i=e("5d11"),r=e("4018"),s=e("db06");function c(n){return n&&n.__esModule?n:{default:n}}function a(n,t,e,o,u,i,r){try{var s=n[i](r),c=s.value}catch(a){return void e(a)}s.done?t(c):Promise.resolve(c).then(o,u)}function d(n){return function(){var t=this,e=arguments;return new Promise((function(o,u){var i=n.apply(t,e);function r(n){a(i,o,u,r,s,"next",n)}function s(n){a(i,o,u,r,s,"throw",n)}r(void 0)}))}}var f=function(){e.e("components/input-comment-reply/input-comment-reply").then(function(){return resolve(e("ed2f"))}.bind(null,e)).catch(e.oe)},m=function(){e.e("components/discuss-comment/discuss-comment").then(function(){return resolve(e("4b27"))}.bind(null,e)).catch(e.oe)},l={data:function(){return{KeyboardHeight:0,showLoading:!0,discussInfo:{},tabList:[{name:"评论"}],photoUrlList:[],errInfo:[],showError:!1,commentErrDict:{content:"评论内容"},revertErrDict:{content:"回复内容"},showEmpty:!1}},components:{discussComment:m,commentInput:f},methods:{replyHandle:function(n){this.$refs.commentInputRef.editStart(n.kind,n.targetUserName,n.targetUserId,n.extra)},getDiscussInfo:function(n){var t=this;return d(o.default.mark((function e(){var u,i;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$http.get(n,{baseURL:""});case 2:u=e.sent,i=u.data,"3"!==i.code?(t.discussInfo=i.data,t.showLoading=!1,t.showEmpty=!1):(t.showLoading=!1,t.showEmpty=!0);case 5:case"end":return e.stop()}}),e)})))()},prePhoto:function(t){var e=this;0===this.photoUrlList.length&&this.discussInfo.image.forEach((function(n){e.photoUrlList.push(n)})),n.previewImage({urls:this.photoUrlList,current:this.photoUrlList[t],indicator:"number"})},subPostData:function(t,e,u,i){var s=this;return d(o.default.mark((function c(){var a,d,f,m,l;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return n.showLoading({title:"发布中",mask:!0}),a=e,d=(0,r.encrypt)(t),o.next=5,s.$http.post(a,d);case 5:f=o.sent,m=f.data,console.log(m),n.hideLoading(),l=s,n.showToast({title:"发布成功",success:function(){l.$refs.commentInputRef.editEnd(),"评论"===u?l.$refs.comment.insertComment(m.data):l.$refs.comment.insertReply(m.data,i)}});case 11:case"end":return o.stop()}}),c)})))()},pushComment:function(n){var t=this,e={content:n.content,discuss:this.discussInfo.id},o={content:{type:"string",max:30,min:1,required:!0,message:"评论内容最少一个字"}},r=new u.default(o),s=this,c=i.commentPushDomain;r.validate(e,(function(o,u){if(o){for(var i in o){var r={name:s.commentErrDict[o[i].field],value:o[i].message};s.errInfo.push(r)}s.showError=!0}else t.subPostData(e,c,"评论",n.extra)}))},pushRevert:function(n){var t=this,e={content:n.content,comment:n.extra.commentId,target_user:n.targetUserId},o={content:{type:"string",max:30,min:1,required:!0,message:"回复内容最少一个字"}},r=new u.default(o),s=this,c=i.revertPushDomain;r.validate(e,(function(o,u){if(o){for(var i in o){var r={name:s.revertErrDict[o[i].field],value:o[i].message};s.errInfo.push(r)}s.showError=!0}else t.subPostData(e,c,"回复",n.extra)}))},startCommentAndReply:function(n){var t=(0,s.checkLogin)();if(t){var e=n.kind;"评论"===e?this.pushComment(n):this.pushRevert(n)}},closeError:function(){this.errInfo=[]}},onLoad:function(n){var t=JSON.parse(decodeURIComponent(n.item));this.getDiscussInfo(t.link)},onShow:function(){var t=this;n.onKeyboardHeightChange((function(n){t.KeyboardHeight=n.height}))},onHide:function(){n.onKeyboardHeightChange((function(n){}))},onReachBottom:function(){this.$refs.comment.pullUp()},watch:{"discussInfo.comment_number":{handler:function(n,t){void 0!==n&&(this.tabList[0].name="评论 "+n.toString())}}}};t.default=l}).call(this,e("543d")["default"])},dadd:function(n,t,e){"use strict";e.r(t);var o=e("8f55"),u=e.n(o);for(var i in o)"default"!==i&&function(n){e.d(t,n,(function(){return o[n]}))}(i);t["default"]=u.a}},[["47f3","common/runtime","common/vendor"]]]);